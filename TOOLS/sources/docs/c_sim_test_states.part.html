<div class="header">
<div class="headertitle">
<h1 class="title">Sample code for SIM States </h1> </div>
</div><meta content="Sample code for SIM States " name="title"></meta><div class="contents">
<div class="textblock"><div class="fragment"><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"></span><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keywordtype">void</span> Print</div><div class="line">(</div><div class="line"> <span class="keywordtype">char</span>* <span class="keywordtype">string</span></div><div class="line">)</div><div class="line">{</div><div class="line"> <span class="keywordtype">bool</span> sandboxed = (getuid() != 0);</div><div class="line"></div><div class="line"> <span class="keywordflow">if</span>(sandboxed)</div><div class="line">    {</div><div class="line"> <a class="code" href="le__log_8h.html#a4ebab29f40ee8eaaa87205fe3f9aaa13">LE_INFO</a>(<span class="stringliteral">"%s"</span>, <span class="keywordtype">string</span>);</div><div class="line">    }</div><div class="line"> <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        fprintf(stderr, <span class="stringliteral">"%s\n"</span>, <span class="keywordtype">string</span>);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"></span><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> DisplaySimState</div><div class="line">(</div><div class="line"> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41">le_sim_States_t</a> state,</div><div class="line"> <a class="code" href="le__sim__interface_8h.html#aace49df88426119626fb1ef4e544ccdd">le_sim_Id_t</a> simId</div><div class="line">)</div><div class="line">{</div><div class="line"> <span class="keywordtype">char</span> <span class="keywordtype">string</span>[100];</div><div class="line"></div><div class="line">    memset(<span class="keywordtype">string</span>,0,100);</div><div class="line"></div><div class="line"> <span class="keywordflow">switch</span>(state)</div><div class="line">    {</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a86aea853ae5fcc1a2e3c8d352d8689d3">LE_SIM_INSERTED</a>:</div><div class="line">            sprintf(<span class="keywordtype">string</span>, <span class="stringliteral">"\nSIM Card state LE_SIM_INSERTED for SIM card.%d \n"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a813e26946372fbc3960aa97713b6ca2f">LE_SIM_ABSENT</a>:</div><div class="line">            sprintf(<span class="keywordtype">string</span>, <span class="stringliteral">"\nSIM Card state LE_SIM_ABSENT for SIM card.%d \n"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41aa7f1f6c3391e32af8ce3ba2242276d64">LE_SIM_READY</a>:</div><div class="line">            sprintf(<span class="keywordtype">string</span>, <span class="stringliteral">"\nSIM Card state LE_SIM_READY for SIM card.%d \n"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41af83b91131d516ad3756781108000515a">LE_SIM_BLOCKED</a>:</div><div class="line">            sprintf(<span class="keywordtype">string</span>, <span class="stringliteral">"\nSIM Card state LE_SIM_BLOCKED for SIM card.%d \n"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a944435801d6359050dc37092396ca951">LE_SIM_BUSY</a>:</div><div class="line">            sprintf(<span class="keywordtype">string</span>, <span class="stringliteral">"\nSIM Card state LE_SIM_BUSY for SIM card.%d \n"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41ad82522676bf094ea402a0311356e434f">LE_SIM_STATE_UNKNOWN</a>:</div><div class="line">            sprintf(<span class="keywordtype">string</span>, <span class="stringliteral">"\nSIM Card state LE_SIM_STATE_UNKNOWN for SIM card.%d \n"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">default</span>:</div><div class="line">            sprintf(<span class="keywordtype">string</span>, <span class="stringliteral">"\nSIM Card state %d for SIM card.%d \n"</span>, state, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    Print(<span class="keywordtype">string</span>);</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"></span><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> TestSimStateHandler</div><div class="line">(</div><div class="line"> <a class="code" href="le__sim__interface_8h.html#aace49df88426119626fb1ef4e544ccdd">le_sim_Id_t</a>     simId,</div><div class="line"> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41">le_sim_States_t</a> simState,</div><div class="line"> <span class="keywordtype">void</span>*           contextPtr</div><div class="line">)</div><div class="line">{</div><div class="line"> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41">le_sim_States_t</a>       state;</div><div class="line"></div><div class="line"> <span class="comment">// Get SIM state</span></div><div class="line">    state = <a class="code" href="le__sim__interface_8h.html#a16b06f266471d81f772e5439ec570144">le_sim_GetState</a>(simId);</div><div class="line"></div><div class="line"> <span class="keywordflow">switch</span>(state)</div><div class="line">    {</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a86aea853ae5fcc1a2e3c8d352d8689d3">LE_SIM_INSERTED</a>:</div><div class="line"> <a class="code" href="le__log_8h.html#a4ebab29f40ee8eaaa87205fe3f9aaa13">LE_INFO</a>(<span class="stringliteral">"-TEST- New state LE_SIM_INSERTED for SIM card.%d"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a813e26946372fbc3960aa97713b6ca2f">LE_SIM_ABSENT</a>:</div><div class="line"> <a class="code" href="le__log_8h.html#a4ebab29f40ee8eaaa87205fe3f9aaa13">LE_INFO</a>(<span class="stringliteral">"-TEST- New state LE_SIM_ABSENT for SIM card.%d"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41aa7f1f6c3391e32af8ce3ba2242276d64">LE_SIM_READY</a>:</div><div class="line"> <a class="code" href="le__log_8h.html#a4ebab29f40ee8eaaa87205fe3f9aaa13">LE_INFO</a>(<span class="stringliteral">"-TEST- New state LE_SIM_READY for SIM card.%d"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41af83b91131d516ad3756781108000515a">LE_SIM_BLOCKED</a>:</div><div class="line"> <a class="code" href="le__log_8h.html#a4ebab29f40ee8eaaa87205fe3f9aaa13">LE_INFO</a>(<span class="stringliteral">"-TEST- New state LE_SIM_BLOCKED for SIM card.%d"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a944435801d6359050dc37092396ca951">LE_SIM_BUSY</a>:</div><div class="line"> <a class="code" href="le__log_8h.html#a4ebab29f40ee8eaaa87205fe3f9aaa13">LE_INFO</a>(<span class="stringliteral">"-TEST- New state LE_SIM_BUSY for SIM card.%d"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">case</span> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41ad82522676bf094ea402a0311356e434f">LE_SIM_STATE_UNKNOWN</a>:</div><div class="line"> <a class="code" href="le__log_8h.html#a4ebab29f40ee8eaaa87205fe3f9aaa13">LE_INFO</a>(<span class="stringliteral">"-TEST- New state LE_SIM_STATE_UNKNOWN for SIM card.%d"</span>, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line"> <span class="keywordflow">default</span>:</div><div class="line"> <a class="code" href="le__log_8h.html#a4ebab29f40ee8eaaa87205fe3f9aaa13">LE_INFO</a>(<span class="stringliteral">"-TEST- New state %d for SIM card.%d"</span>, state, simId);</div><div class="line"> <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"> <span class="keywordflow">if</span>((state&gt;=<a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a86aea853ae5fcc1a2e3c8d352d8689d3">LE_SIM_INSERTED</a>) &amp;&amp; (state&lt;=<a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41ad82522676bf094ea402a0311356e434f">LE_SIM_STATE_UNKNOWN</a>))</div><div class="line">    {</div><div class="line"> <a class="code" href="le__log_8h.html#a4ebab29f40ee8eaaa87205fe3f9aaa13">LE_INFO</a>(<span class="stringliteral">"-TEST- Check le_sim_GetState passed."</span>);</div><div class="line">    }</div><div class="line"> <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line"> <a class="code" href="le__log_8h.html#a3ee3d0451bd7351a6252c9487452d175">LE_ERROR</a>(<span class="stringliteral">"-TEST- Check le_sim_GetState failure !"</span>);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"></span><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keywordtype">void</span> simTest_State</div><div class="line">(</div><div class="line"> <a class="code" href="le__sim__interface_8h.html#aace49df88426119626fb1ef4e544ccdd">le_sim_Id_t</a> simId,</div><div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* pinPtr</div><div class="line">)</div><div class="line">{</div><div class="line"> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a>                 res;</div><div class="line"> <a class="code" href="le__sim__interface_8h.html#a2762b1c04a51b185890700b0fa94f92d">le_sim_NewStateHandlerRef_t</a> testHdlrRef;</div><div class="line"> <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41">le_sim_States_t</a>             state;</div><div class="line"> <span class="keywordtype">char</span> <span class="keywordtype">string</span>[100];</div><div class="line"></div><div class="line">    memset(<span class="keywordtype">string</span>, 0, 100);</div><div class="line"></div><div class="line"> <span class="comment">// Get SIM state</span></div><div class="line">    state = <a class="code" href="le__sim__interface_8h.html#a16b06f266471d81f772e5439ec570144">le_sim_GetState</a>(simId);</div><div class="line"></div><div class="line"> <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((state &gt;= <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a86aea853ae5fcc1a2e3c8d352d8689d3">LE_SIM_INSERTED</a>) &amp;&amp; (state &lt;= <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a944435801d6359050dc37092396ca951">LE_SIM_BUSY</a>));</div><div class="line">    sprintf(<span class="keywordtype">string</span>, <span class="stringliteral">"\nSIM Card.%d state:\n"</span>, simId);</div><div class="line">    Print(<span class="keywordtype">string</span>);</div><div class="line"></div><div class="line">    DisplaySimState(state, simId);</div><div class="line"></div><div class="line"> <span class="keywordflow">if</span>(state == <a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a86aea853ae5fcc1a2e3c8d352d8689d3">LE_SIM_INSERTED</a>)</div><div class="line">    {</div><div class="line"> <span class="comment">// Enter PIN code</span></div><div class="line">        res = <a class="code" href="le__sim__interface_8h.html#a7d9de57c8931013432cd41b26d1e7585">le_sim_EnterPIN</a>(simId, pinPtr);</div><div class="line"> <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(res==LE_OK);</div><div class="line"></div><div class="line"> <span class="comment">// Get SIM state</span></div><div class="line">        state = <a class="code" href="le__sim__interface_8h.html#a16b06f266471d81f772e5439ec570144">le_sim_GetState</a>(simId);</div><div class="line"> <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((state&gt;=<a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a86aea853ae5fcc1a2e3c8d352d8689d3">LE_SIM_INSERTED</a>) &amp;&amp; (state&lt;=<a class="code" href="le__sim__interface_8h.html#a21b9bb7d5e5e7ece213e00738a5bae41a944435801d6359050dc37092396ca951">LE_SIM_BUSY</a>));</div><div class="line">    }</div><div class="line"></div><div class="line"> <span class="comment">// Add the state handler</span></div><div class="line">    testHdlrRef = <a class="code" href="le__sim__interface_8h.html#a8e296a7cd35edd99cb1dc21232e280dd">le_sim_AddNewStateHandler</a>(TestSimStateHandler, NULL);</div><div class="line"> <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(testHdlrRef != NULL);</div><div class="line">}</div></div><!-- fragment --></div></div>